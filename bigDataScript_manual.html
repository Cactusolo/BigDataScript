<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BigDataScript</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/docs.css" rel="stylesheet">
    <link href="js/google-code-prettify/prettify.css" rel="stylesheet">
	<link href="css/my.css" rel="stylesheet">

    <!-- hTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="ico/favicon.png">

  </head>

  <body data-spy="scroll" data-target=".bs-docs-sidebar">

    <!-- Navbar
    ================================================== -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">BigDataScript</a>
          <div class="nav-collapse collapse">
            <p class="navbar-text pull-right">
            </p>
            <ul class="nav">
              <li class="active"><a href="index.html">Home</a></li>
              <li><a href="https://github.com/pcingola/BigDataScript">Download</a></li>
              <li><a href="bigDataScript_manual.html">Documentation</a></li>
              <li><a href="about.html">About</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

<!-- Subhead
================================================== -->
<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>BigDataScript</h1>
    <p class="lead">Documentation</p>
  </div>
</header>


  <div class="container">

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#install"><i class="icon-chevron-right"></i> Download &amp; Install</a></li>
          <li><a href="#intro"><i class="icon-chevron-right"></i> Introduction</a></li>
          <li><a href="#myfirst"><i class="icon-chevron-right"></i> Video: My first bds script</a></li>
          <li><a href="#task"><i class="icon-chevron-right"></i> Video: Scheduling tasks</a></li>
          <li><a href="#taskCluster"><i class="icon-chevron-right"></i> Video: Scheduling tasks on a cluster</a></li>
          <li><a href="#taskDep"><i class="icon-chevron-right"></i> Video: Creating pipelines: Task dependencies</a></li>
          <li><a href="#taskDep2"><i class="icon-chevron-right"></i> Video: More on task dependencies </a></li>
          <li><a href="#cool"><i class="icon-chevron-right"></i> Video: Some cool features </a></li>
          <li><a href="#language"><i class="icon-chevron-right"></i> Language definition </a></li>
          <li><a href="#dataTypes"><i class="icon-chevron-right"></i> Data types </a></li>
          <li><a href="#sys"><i class="icon-chevron-right"></i> Sys </a></li>
          <li><a href="#taskExpr"><i class="icon-chevron-right"></i> Task </a></li>
          <li><a href="#log"><i class="icon-chevron-right"></i> Logging </a></li>
          <li><a href="#waitExpr"><i class="icon-chevron-right"></i> Wait </a></li>
          <li><a href="#dep"><i class="icon-chevron-right"></i> Dependency operator </a></li>
          <li><a href="#check"><i class="icon-chevron-right"></i> Checkpoints </a></li>
          <li><a href="#vars"><i class="icon-chevron-right"></i> Predefined variables </a></li>
        </ul>
      </div>
      <div class="span9">


        <!-- ================================================== -->
        <section id="install">
          <div class="page-header">
            <h1>1. Download &amp; Install</h1>
          </div>
				<p class="lead"> BigDataScript a scripting language for big data pipelines.  </p>
				<p>
				The source code is available on <a href="https://github.com/pcingola/BigDataScript">GitHub </a>.
				How to install:
<pre>
# Clone repository
$ git clone https://github.com/pcingola/BigDataScript.git

# Run 'install script
$ cd BigDataScript
$ ./scripts/install.sh
</pre>

				Then edit your <code>.bashrc</code> (or <code>.bash_profile</code>) and add the following lines
<pre>
# BigDataScript
export CLASSPATH=$CLASSPATH:$HOME/.bds/BigDataScript.jar
export PATH=$PATH:$HOME/.bds/
</pre>

				Optionally, if you have root access, you can do the following (to get <code>bds</code> available everywhere in your system
<pre>
$ su -
# cd /usr/bin/
# ln -s /home/your_user/.bds/bds
</pre>

				</p>
				<h3> Licencing </h3>
				<p>
				Open source.
				</p>
				<h3> Source code</h3>
				<p>
				The source code is available on <a href="https://github.com/pcingola/BigDataScript">GitHub </a>.
				</p>
				<h3> Software archtecture </h3>
				<p>
				The source code is mostly written in Java and it has some parts in <a href="http://golang.org/">Go</a>. We use <a href="http://www.antlr.org/">ANTLR</a> as Lexer &amp; parser.
				<br>
				If you want to develop, you'll need:
				<ul>
					<li> Java (at least 1.6)
					<li> Go compiler (at least 1.0)
					<li> Git
				</ul>
				<br>
				</p>
			
        </section>

        <!-- ================================================== -->
        <section id="intro">
          <div class="page-header">
            <h1>2. Introduction</h1>
          </div>
				<p class="lead">
				BigDataScript is intended as a scripting language for big data pipeline. 
				</p>
				<h3>What?</h3>
				<p>
				BigDataScript is a cross-system scripting language for working with big data pipelines in computer systems of different sizes and capabilities.
				</p>
				<h3>Why?</h3>
				Working with heavyweight computation and big data pipelines involves making use of several specialized programs. 
				Those specialized routines need to be scheduled, called and coordinated; their progress need to be tracked and their results logged. 
				That is the job of another script or program. This is when BigDataScript becomes extremely handy.
				<br>
				<br>
				Developing traditional shell scripts or small programs to coordinate data pipelines presents a fundamental dilemma. 
				It is not cross-platform, it simply does not work on all environments or it needs adaptations and re-work for the same thing to work on a laptop, server, server farm, cluster and cloud. 
				Often it is simply not possible. 
				Because of that, developing big data pipelines for a different environment is time consuming. 
				The behaviour on the target environment cannot be assumed to be an exact extrapolation of the results obtained on the development environment. 
				This not only is a waste of time, money and energy, it is also reliable source of frustration.
				<br>
				<br>
				BigDataScript is the solution to the problem.
				<br>
				<br>
				With BigDataScript, creating a jobs for big data is as easy as creating a shell script and it runs seamlessly on any computer system, no matter how small or big it is. 
				If you normaly use of specialized programs to perform heavyweight computations, then BigDataScript is the glue to those commands you need to create a reliable pipeline.
				<h3>How?</h3>

				<p class="lead">
				<b> Benefis of BigDataScript </b>
				</p>
				<ul>
					<li> <b>Reduced development time</b> 
					<p>
					Spend less time debugging your work on big systems with a huge data volumes. 
					Now you can debug the same jobs using a smaller sample on your computer. 
					Get immediate feedback, debug, fix and deploy when it's done. 
					Shorter development cycles means better software.
					</p>

					<li> <b>System independent</b> 
					<p>
					Cross-system, seamless execution, the same program runs on a laptop, server, server farm, cluster or cloud. 
					No changes to the program required. 
					Work once.
					</p>

					<li> <b>Easy to learn</b> 
					<p>
					The syntax is intuitive and it resembles the syntax of most commonly used programming languages. 
					Reading the code is easy as pi.
					</p>

					<li> <b>Automatic Checkpointing</b> 
					<p>
					If any task fails to execute, BigDataScript creates a checkpoint file, serializing all the information from the program. 
					Want to re-start were it stopped? 
					No problem, just resume the execution from the checkpoint.
					</p>

					<li> <b>Automatic logging</b> 
					<p>
					Everything is logged by default, no explicit actions required. 
					Every time you execute a system command or a task, BigDataScript logs the executed commands, stdout &amp; stderr and exit codes.
					</p>

					<li> <b>Clean stop with no mess behind</b> 
					<p>
					You have a BigDataScript running on a terminal and suddenly you realized there is something wrong... 
					Just hit Ctrl-C. 
					All scheduled tasks and running jobs will be terminated, removed from the queue, deallocated from the cluster. 
					A clean stop allows you to focus not he problem at hand without having to worry about restoring a clean state.
					</p>

					<li> <b>Task dependencies</b> 
					<p>
					In complex pipelines, tasks usually depend on each other. 
					BigDataScript provides ways to easily manage task dependencies.
					</p>

					<li> <b>Avoid re-work</b> 
					<p>
					Executing the pipeline over and over should not re-do jobs that were completed successfully and moreover are time consuming. 
					Task dependency based on timestamps is a built-in functionality, thus making it easy to avoid starting from scratch every time.
					</p>
				</ul>

				<h3> A word about performance</h3>
				<p>
				BigDataScript is meant to be used in the context or heavyweight computations.
				Potential delays incurred by BigDataScript should not affect the overall time.
				<br>
				Think about it this way: If you are invoking a set of programs to perform big data computations, these programs usually take hours or days to run.
				The fact that BigDataScript takes a few miliseconds more to invoke those programs, really doesn't make any difference.
				</p>

				<h3> Disclaimer </h3>
				BigDataScript is experimental and under heavy development. 
				At this time this is not for the faint of heart.
				<br>
				<br>
				<i class="icon-warning-sign"></i> Use at your own risk!
				<br>
				<br>
        </section>

        <!-- ================================================== -->
        <section id="myfirst">
          <div class="page-header">
            <h1>3. Video: My first BigDataScript </h1>
          </div>
				<p class="lead">
				Here we show an introduction to BigDataScript (<code>bds</code>) command line.
				<p>
				
				<iframe width="640" height="390" src="http://www.youtube.com/embed/WnwBIa4G-mE" frameborder="0" allowfullscreen></iframe>
				
				<p class="lead"> In this video <p>
				<ul>
					<li> Running the command line without arguments, shows a small help
<pre>
$ bds
Error: Missing program file name.
Usage: BigDataScript [options] file.bds
BigDataScript 0.7 (build 2013-03-08), by Pablo Cingolani


Available options: 
  [-c | -config] file    : Config file. Default : /home/pcingola/.bds/bigdatascript.config
  [-d | -debug]          : Debug mode.
  [-r | -restore] file   : Restore from checkpoint file.
  [-v | -verbose]        : Be verbose.
  [-pid] <file>          : Write local processes PIDs to 'file'
  -noLog                 : Do not log stats.
</pre>

					<li> Create a simple program to print "Hi", and execute the script
<pre>
$ cat z.bds 
print("Hi\n")
$ bds z.bds 
Hi
</pre>

					<li> Running system command is done using a <code>sys</code> expression. 
					A sys command is sequencial, so the program does not continue until the system command returns.
<pre>
$ cat z.bds
sys echo Hi
$ bds z.bds
Hi
</pre>

					<li> Running complex tasks can be done using a <code>task</code> expression.
					A <code>task</code> command is queued for execution. 
					So the program can continue even if the task has not finished (or has not even started) execution.
					<br>
					<i class="icon-warning-sign"></i> Task execution order is not waranteed (e.g. a cluster scheduler can decide to run task_2 before task_1).
					We'll see how to coordinate tasks later.
<pre>
$ cat z.bds
sys echo Hi
$ bds z.bds
Hi
</pre>
				</ul>
				</p>
        </section>

        <!-- ================================================== -->
        <section id="task">
          <div class="page-header">
            <h1>4. Video: Scheduling tasks </h1>
          </div>
				<p class="lead">
				Task are scheduled according to available resources.
				<p>
				
				<iframe width="640" height="390" src="http://www.youtube.com/embed/ehFfU8vLwi8" frameborder="0" allowfullscreen></iframe>
				</p>
				
				<p class="lead"> In this video <p>
				<ul>
					<li> Schedule 10 tasks to be executed
<pre>
$ cat z.bds
for( int i=0 ; i < 10 ; i++ ) {
	task echo Hi $i ; sleep 1 ; echo Done $i ; sleep 1
}
$ bds z.bds
Hi 1
Hi 6
Hi 2
Hi 4
Hi 3
Hi 7
Hi 0
Hi 5
Done 1
Done 6
Done 2
Done 4
Done 3
Done 7
Done 0
Done 5
Hi 9
Hi 8
Done 9
Done 8
</pre>

        <!-- ================================================== -->
        <section id="taskCluster">
          <div class="page-header">
            <h1>5. Video: Scheduling tasks on a cluster </h1>
          </div>
				<p class="lead">
				Here we show how exactly the same script is run on a cluser...not a single line of code changed.
				<p>
				
				<iframe width="640" height="390" src="http://www.youtube.com/embed/o47wxUdYzvk" frameborder="0" allowfullscreen></iframe>
				</p>
				
				<p class="lead"> In this video <p>
				<ul>
					<li> We copy tha same script (used in the previous section) to a cluster. 
					We execute it, but now the tasks are schedules using MOAB, Torque or Grid Engine.
					<br>
					The only change we made is to add <code>-s cluster</code> to the command line. 
<pre>
$ bds -s cluster z.bds
</pre>

					<li> Typing <code>-s cluster</code> can also be avoided just using a config file.

				</ul>
        </section>

        <!-- ================================================== -->
        <section id="taskDep">
          <div class="page-header">
            <h1>6. Creating pipelines: Task dependencies</h1>
          </div>
				<p class="lead">
				In a tipical pipeline tasks are not just scheduled for execution.
				We need to be able to control task based on previously executed tasks.
				Here we show how.
				<p>
				
				<iframe width="640" height="390" src="http://www.youtube.com/embed/vTekXn3sKzs" frameborder="0" allowfullscreen></iframe>
				</p>
				
				<p class="lead"> In this video <p>
				<ul>
					<li> 
					We run a set of tasks (<code>echo Hi $i</code>) and after all the tasks finished, we run another set of tasks (<code>echo Bye $i</code>)
					<br>
					The only change we made is to add <code>-s cluster</code> to the command line. 
<pre>
$ bds z.bds
Before wait
Hi 7
Hi 1
Hi 3
Hi 6
Hi 4
Hi 2
Hi 5
Hi 0
Hi 9
Hi 8
After wait
Bye 2
Bye 1
Bye 3
Bye 0
Bye 5
Bye 7
Bye 6
Bye 4
Bye 8
Bye 9
</pre>

					<li> The <code>wait</code> statement is like a barrier. Untill all tasks are finished, the program does not continue.
					If any task fails, a checkpoint file is created, where all program data is serialized.
					We can correct the problem and re-start the pipeline were it left.

					<li> The <code>wait</code> statement can wait for all tasks, for single tasks or for a list of tasks.

					<li> We then run the same script on a cluster. 
					Again, this is done simply by using <code>-s cluster</code> command line.
					The video shows how tasks are scheduled and on the cluster, always honoring the <code>wait</code> statement

					<li> Finally we show that the exit code of a <code>bds</code> script is 0 if all tasks executed without any problems, and non-zero if there were probelms.

				</ul>
        </section>

        <!-- ================================================== -->
        <section id="taskDep2">
          <div class="page-header">
            <h1>7. Video: More on task dependencies </h1>
          </div>
				<p class="lead">
				If we already processed a file and have the results, we may choose to save some work if the input has not changed.
				We show how to execute tasks depending on file creation times (think "make").
				<p>
				
				<iframe width="640" height="390" src="http://www.youtube.com/embed/oSjhkRuc0I8" frameborder="0" allowfullscreen></iframe>
				</p>
				
				<p class="lead"> In this video <p>
				<ul>
					<li> We introduce the dependency operator <code>&lt;-</code> (pronounced 'dep') which is a "make" style operator.

					<li> The expression <code>out &lt;- in</code> is true if 'out' file needs to be updated.
					More formally, the expression is true if the file name represented by the variable 'out' does not exists, is empty (zero length) or has a creation date before 'in'.<br>
					E.g.:
<pre>
$ cat z.bds
string inFile = "in.txt"
string outFile = "out.txt"

tash echo Creating $inFile; echo Hello > $inFile

wait

if( outFile <- inFile ) {
	task echo Creating $outFile; cat $inFile > $outFile
}

$ bds z.bds
Creating in.txt
Creating out.txt

$ cat out.txt
Hello
</pre>

					<li> If the file 'out.txt' is up to date, the the following code will not execute
<pre>
if( outFile <- inFile ) {
	task echo Creating $outFile; cat $inFile > $outFile
}
</pre>

					<li> This construction is so common, that we allow for some sintactic sugar. 
					So you can write it the following way:
<pre>
task( outFile <- inFile ) { 
	sys echo Creating $outFile; cat $inFile > $outFile
}
</pre>
				</ul>
        </section>

        <!-- ================================================== -->
        <section id="cool">
          <div class="page-header">
            <h1>8. Video: Some cool features </h1>
          </div>
				<p class="lead">
				BigDataScript has some useful features, like automatic command line parsing.
				<p>
				
				<iframe width="640" height="390" src="http://www.youtube.com/embed/oSjhkRuc0I8" frameborder="0" allowfullscreen></iframe>
				</p>
				
				<p class="lead"> In this video <p>
				<ul>
					<li> We show how automatic command line parsing works.
					We use the same script as shown in the previous section for processing another input file without changing a single line of code.
					
					<li> Automatic command line parsing parses any command line argument that starts with "-" and assigns the value to the corresponding variable.
					E.g.:
<pre>
$ cat z.bds 
string in = "in.txt"
print("In file is '$in'\n")

$ bds z.bds
In file is 'in.txt'

$ bds z.bds -in anotherFile.txt
In file is 'anotherFile.txt'
</pre>

				<li> This feature also works for other data types (int, real, bool). 
				In case of bool if the option is present, the variable is set to 'true'.
<pre>
$ cat z.bds
bool flag
print("Variable flag is $flag\n")

$ bds z.bds
Variable flag is false

$ bds z.bds -flag
Variable flag is true

</pre>

				</ul>
        </section>

        <!-- ================================================== -->
        <section id="language">
          <div class="page-header">
            <h1>9. Language definition </h1>
          </div>
				<p class="lead">
				BigDataScript language is almost trivial, here are some basic definitions in case you are curious.
				</p>
				<p>
				Statements can be terminated either by semicolon or by a new line.
				<br>
				All the usual statements are available:
				<ul>
					<li> Comments
<pre>
// Single line comment

# Another single line comment

/*
   Multi-line comment
*/
</pre>
					<li> <code>if / else</code> It does exactly what you expect
<pre>
if( i < 10 )	print("Less than ten\n")
</pre>
					or
<pre>
if( i < 10 ) {
	print("Less than ten\n")
} else {
	print("More than ten\n")
}
</pre>

					<li> <code>for</code> C or Java like for statement
<pre>
for( int i=0 ; i < 10 ; i++ ) print("$i\n")
</pre>
					or
<pre>
for( int i=0 ; i < 10 ; i++ ) {
	print("$i\n")
}
</pre>

					<li> <code>for</code> Java like for iterator on lists
<pre>
string[] mylist
// Some code to populate the list
for( string s : mylist ) print("$s\n")
</pre>

					<li> <code>while</code> typical while iterator
<pre>
while( i < 10 ) i++
</pre>

					<li> <code> break </code>: Breaks from current loop
					<li> <code> continue </code>: Continue at the end of the current loop
					<li> <code> exit expression?</code>: Exit program, optional expression calculates an exit value.
					<li> <code> kill </code> Kill a task
					<li> <code> wait expression?</code> Wait for task/s to finish. It can be one task, a list of tasks or all tasks (if no expression)
					<li> <code> checkpoint expression?</code> Create a checkpoint. Optional expresion is a file name
					<li> <code> return expression?</code> Return from a function. Optional expression is a return value.
				</ul>

				<br>
				<br>
				A simple, and useless, example:
<pre>
// Define a function
int sumPositive(int n) {
    if( n <= 0 )    return 0

    int sum = 0
    for( int i=0 ; i <= n ; i++ ) sum = sum + i
    return sum
}


// Main
int N = 10
print("The sum is : " + sumPositive(N) + "\n" )
</pre>
				Obviously, if you run it
<pre>
$ bds z.bds 
The sum is : 55
</pre>
				</p>

				
        </section>

        <!-- ================================================== -->
        <section id="dataTypes">
          <div class="page-header">
            <h1>10. Data types </h1>
          </div>
				<p class="lead">
				Statically typed language.
				<p>

				<h3> Only a few simple types</h3>
				The language is statically typed. 
				The intention is to avoid runtime errors.
				<br>
				<br>
				There are only a few basic types :

				<table class="table table-striped">
					<tr> <th> Type   </th> <th> Meaning </th> </tr>
					<tr> <td> string </td> <td> A string (same a Java's String) </td> </tr>
					<tr> <td> int    </td> <td> A 64 bit integer number (same a Java's long) </td> </tr>
					<tr> <td> real   </td> <td> A 64 bit IEEE 754 number (same as Java's double) </td> </tr>
					<tr> <td> bool   </td> <td> A boolean value, can be 'true' or 'false' (same as Java's boolean)</td> </tr>
					<tr> <td> Arrays, List, Stacks   </td> <td> These are all the same, just a different way to call a list of elements</td> </tr>
					<tr> <td> Maps   </td> <td> Maps are not currently supported. They will be implemented soon </td> </tr>
				</table>

				There is no "null" element. Again, the idea is to minimize points of failura.

				
				<h3> Strings </h3>
				There are several basic methods defined for strings:

				<table class="table table-striped">
					<tr> <th>Return type</th><th> Method / Operator</th> <th> Meaning </th> </tr>
					<tr> <td> string   </td><td> s = s1 + s2							</td> <td> Concatenate strings.</td> </tr>
					<tr> <td> string   </td><td> string.toUpper()						</td> <td> Return an upper case version of the string</td> </tr>
					<tr> <td> string   </td><td> string.toLower()						</td> <td> Return a lower case version of the string</td> </tr>
					<tr> <td> string   </td><td> string.trim()							</td> <td> Trim spaces at the beginnig and at the end</td> </tr>
					<tr> <td> string   </td><td> string.substr(int start,int end)       </td> <td> Substring from start to end</td> </tr>
					<tr> <td> string[] </td><td> string.split(string regex)				</td> <td> Split using a regular expression </td> </tr>
					<tr> <td> string[] </td><td> string.lines()							</td> <td> Split a string into lines </td> </tr>
					<tr> <td> bool     </td><td> string.isEmpty()                       </td> <td> True if the string is empty</td> </tr>
					<tr> <td> bool     </td><td> string.startsWith(string str)			</td> <td> True if string starts with str</td> </tr>
					<tr> <td> bool     </td><td> string.endsWith(string str)			</td> <td> True if string ends with str</td> </tr>
					<tr> <td> bool     </td><td> string.indexOf(string str)				</td> <td> Index of th first occurrence of str in string</td> </tr>
					<tr> <td> int      </td><td> string.lastIndexOf(string str)			</td> <td> Index of th last occurrence of str in string</td> </tr>
					<tr> <td> string   </td><td> string.replace(string str1,string str2)</td> <td> A new string replacing 'str1' with 'str2'</td> </tr>
				</table>

				<h3> Strings as file names </h3>
				Strings can be used in several different ways.
				For instance, it is common that a string can represent a file name in a script.
				So you can use 'file' related methods on string.
				E.g.:
<pre>
string f = "in.txt"
if( f.canRead() ) {
	print (" Can read file $f\n" )
}
</pre>
				Here <code>f</code> is a string, but it has a method <code>canRead()</code> which retuurns true if f is a file and it can be read.
				<br>
				<br>
				More file related methods:

				<table class="table table-striped">
					<tr> <th>Return type</th><th> Method</th> <th> Meaning </th> </tr>
					<tr><td>string        </td> <td>string.path()                      </td> <td> Canonical path to file    </td> </tr>
					<tr><td>string        </td> <td>string.baseName()                  </td> <td> File's base name    </td> </tr>
					<tr><td>string        </td> <td>string.baseName(string ext)        </td> <td> File's base name, remove extention 'ext'    </td> </tr>
					<tr><td>string        </td> <td>string.dirName()                   </td> <td> File's directory name    </td> </tr>
					<tr><td>string        </td> <td>string.extName()                   </td> <td> File's extension    </td> </tr>
					<tr><td>bool          </td> <td>string.canRead()                   </td> <td> True if file has read permission    </td> </tr>
					<tr><td>bool          </td> <td>string.canWrite()                  </td> <td> True if file has write permission   </td> </tr>
					<tr><td>bool          </td> <td>string.canExec()                   </td> <td> True if file has execution permission    </td> </tr>
					<tr><td>bool          </td> <td>string.exists()                    </td> <td> True if file exists    </td> </tr>
					<tr><td>bool          </td> <td>string.isDir()                     </td> <td> True if it's a directory    </td> </tr>
					<tr><td>bool          </td> <td>string.isFile()                    </td> <td> True if it's a file    </td> </tr>
					<tr><td>bool          </td> <td>string.delete()                    </td> <td> Delete file    </td> </tr>
					<tr><td>bool          </td> <td>string.mkdir()                     </td> <td> Create dir ('mkdir -p')   </td> </tr>
					<tr><td>string        </td> <td>string.read()                      </td> <td> Read the whole file into a string    </td> </tr>
					<tr><td>string[]      </td> <td>string.readLines()                 </td> <td> Read the whole file and split the lines    </td> </tr>
					<tr><td>string[]      </td> <td>string.dir()                       </td> <td> List files in a directory ('ls')   </td> </tr>
					<tr><td>string[]      </td> <td>string.dir(string regex)           </td> <td> List files matching a regular expression </td> </tr>
					<tr><td>string[]      </td> <td>string.dirPath()                   </td> <td> List files using canonical paths    </td> </tr>
					<tr><td>string[]      </td> <td>string.dirPath(string regex)       </td> <td> List files, matching a regular expresion, using canonical paths    </td> </tr>
					<tr><td>int           </td> <td>string.size()                      </td> <td> File size in bytes  </td> </tr>
				</table>
				
				<h3> Strings as task IDs </h3>
				Strings can also be used to refer to tasks.
				When a task is created, the <code>task</code> expression returns a task ID, which is a string.
				This task ID can be used for task operations, for instance:
<pre>
string tid = task echo Hello
wait tid
</pre>
				Here the <code>wait</code> statement will wait until the task "echo Hello" finishes executing.
				<br>
				<br>
				More task related methods:
				<table class="table table-striped">
					<tr> <th>Return type</th><th> Method</th> <th> Meaning </th> </tr>
					<tr> <td> bool    </td> <td> string.isDone()   </td> <td> True if the task finished</td> </tr>
					<tr> <td> bool    </td> <td> string.isDoneOk() </td> <td> True if the task finished without errors </td> </tr>
					<tr> <td> string  </td> <td> string.stdout()   </td> <td> A string with all the STDOUT generated from this task </td> </tr>
					<tr> <td> string  </td> <td> string.stderr()   </td> <td> A string with all the STDERR generated from this task </td> </tr>
					<tr> <td> int     </td> <td> string.exitCode() </td> <td> Exit code</td> </tr>
				</table>

				<h3> Arrays, List, Stacks </h3>
				Arrays, list and stacks are all the same thing.
				You can create a list of strings simply by declaring <code> string[] myStringList </code>. 
				Similarly, a list of ints is just <code> int[] myIntList </code>. 
				<br>
				<br>
				Methods:
				<table class="table table-striped">
					<tr> <th>Returns </th><th> Method</th> <th> Meaning </th> </tr>
					<tr> <td> Element added  </td> <td> add </td> <td> Add at the end og the list </td> </tr>
					<tr> <td> First element  </td> <td> head </td> <td> Get first element </td> </tr>
					<tr> <td> Last element  </td> <td> pop </td> <td> Get last element and remove it from the list </td> </tr>
					<tr> <td> Element pushed  </td> <td> push </td> <td> Add at the end of the list </td> </tr>
					<tr> <td> int </td> <td> size() </td> <td> Return the number of elements in the list </td> </tr>
					<tr> <td> New sorted list </td> <td> sort() </td> <td> Create a new list sorting the elements of this list</td> </tr>
					<tr> <td> List  </td> <td> tail() </td> <td> Create a new list with all but the first element</td> </tr>
				</table>
				</p>
        </section>

        <!-- ================================================== -->
        <section id="sys">
          <div class="page-header">
            <h1>11. Sys </h1>
          </div>
				<p class="lead"> Local, immediate command execution.  <p>

				A <code>sys</code> statement immediately executes a command (an OS command) in the local machine.
				BigDataScript executions is suspended until the command terminates.
				If the command exits with an error condition, the bds program creates a checkpoint, and exits with a non-zero exit code.
				<br>
				<br>
				<i class="icon-warning-sign"></i>  SYS expressions are executed in the local computer without looking at resources consumed.
				<br>
				<br>
				E.g.
<pre>
$ cat z.bds
print("Before\n")
sys echo Hello
print("After\n")

$ bds z.bds
Before
Hello
After
</pre>

				Everything after a <code>sys</code> keyword until the end of the line is considered part of the command to be executed.
				So mutiple commands can be separated by semicolon
<pre>
sys echo Hello ; echo Bye
</pre>

				Multi-line stalements are allowed, by using a back-slash at the end of the line
<pre>
sys echo HeLLo \
    | tr [A-Z] [a-z]
</pre>
				This program prints <code>hello</code> (all lower case)
				</p>
        </section>


        <!-- ================================================== -->
        <section id="taskExpr">
          <div class="page-header">
            <h1>12. Task </h1>
          </div>
				<p class="lead"> Queued command execution with resource management. </p>

				A <code>task</code>expression, just like <code>sys</code> expression, also executes a command.
				The main difference is that a <code>task</code> is "scheduled for execution" instead of executed immediately.
				Task execution order is not warranteed, but <code>bds</code> provides mechanism for task dependencies by means of <code>wait</code> statements.
				<br>
				<br>
				A task expression either performs basic resource management or delegates resource management to cluster management tools.
				The idea is that if you schedule a hundred tasks, but you are executing on your laptop which only has 4 CPUs, then <code>bds</code> will only execute 4 tasks at a time.
				The rest of the tasks are queued for later execution.
				As executing tasks finish and CPUs become available, the reamining tasks are executed.
				<br>
				Similarly, if you schedule 10,000 tasks for execution, but your cluster only has 1,000 cores, then only 1,000 tasks will be executed as a given time.
				Again, other tasks are queued for later execution, but in this case all the resource management is done by your cluster's workload management system (e.g. GridEngine, PBS, Torque, etc.).
				<br>
				<br>
				<i class="icon-warning-sign"></i> Most cluster resource management do not warantee that tasks are executed in the same order as queued.
				Even if they do or if they are executed in the same host, a task can start execution and immediately be preempted. 
				So the next task in the queue can efectively start before the previous one.
				<br>
				<br>
				There are different ways to execute tasks<br>
				<table class="table table-striped">
					<tr>
						<th> System type </th>
						<th> Typical usage </th>
						<th> How it is done </th>
					</tr>
					<tr>
						<td> <code>local</code> </td>	
						<td> Running on a single computer. E.g. programming and debugging on your laptop or running stuff on a server </td> 
						<td> A local queue is created, the total number of CPUs used by all tasks running is less or equal then the number of CPU cores available </td> 
					</tr>
					<tr>
						<td> <code>ssh</code> </td>	
						<td> A server farm or a bunsh of desktops or servers without a workload management system (e.g. computers in a University campus) </td>
						<td> Basic resource management is performed by logging into all computers in the 'cluster' an monitoring resource usage. </td>
					</tr>
					<tr> 
						<td> <code>cluster</code> </td>
						<td> Running on a cluster (GridEngine, Torque) </td>
						<td> Tasks are scheduled for execution (using 'qsub' or equivalent command). Resource management is delegated to cluster workload management. </td>
					</tr>
					<tr> 
						<td> cloud <code>cluster</code> </td>
						<td> Running on a Amazon via <a href="http://star.mit.edu/cluster/">StarCluster</a> </td>
						<td> This is the same as 'cluster', the only difference is that the cluster runs on a Cloud via MIT's StarCluster. </td>
					</tr>
					<tr> 
						<td> <code>cloud</code> </td>
						<td> Running on a Amazon <a href="http://aws.amazon.com/swf/">Simple Workflow Service (SWF)</a> </td>
						<td> A basic resource management is layered on top of Amazon Simple Workflow Service (SWF). Processing capacity can be increased or decrease on demand. Price optimization using spot instances can be added. </td>
					</tr>
				</table>

				<br>
				<i class="icon-warning-sign"></i> Using cloud based services, you can incurr in extra charges due to software bugs.
				Use at your own risk!
				<br>
				<br>
				<i class="icon-warning-sign"></i>  Amazon Simple Workflow Service (SWF), on demand capacity and spot instance pricing is experimental.
				You must closely monitor your processes and instances to avoid charges due to software bugs.
				<br>
				<br>
				<h3> Scheduling tasks </h3>
				A task is scheduled by means of a <code>task</code> expression.
				A <code>task</code> expression returns a task ID, a string representing a task.
				E.g.:
<pre>
$ cat z.bds
string tid = task echo Hello 
print("Task is $tid\n")

$ bds z.bds
Task is z.bds.20130329_130235_269/task.line_1.id_1
Hello
</pre>

				Many tasks can be scheduled by simply invoking a task statement many times. 
				Execution order depends on underliying system and there is absolutely no warrantees about execution order (unless you use a <code>wait</code> statement).
				<br>
				E.g., clearly all the tasks are NOT executed in order:
<pre>
$ cat z.bds
for( int i=0 ; i < 10 ; i++ ) task echo Hi $i

$ bds z.bds
Hi 0
Hi 5
Hi 4
Hi 3
Hi 2
Hi 1
Hi 7
Hi 6
Hi 9
Hi 8
</pre>

			<h3> Resource consumption and task options</h3>
			It is not uncommon to have a task that requires many CPUs.
			In such case, we should inform the resource management system in order to get an efficient allocation of resources (plus many cluster systems kill tasks that fail to report this).
			<br>
			E.g., In this example we allocate 4 CPUs per task and run it on an 8-core computer, so obviously only 2 tasks can run at the same time:
<pre>
$ cat z.bds
for( int i=0 ; i < 10 ; i++ ) {
	# Inform resource management that we need 4 core on each of these tasks
	task ( cpus=4 ) {
		sys echo Hi $i ; sleep 2; echo Done $i
	}
}

$ bds z.bds
Hi 0
Hi 1
Done 0
Done 1
Hi 3
Hi 2
Done 2
Done 3
Hi 4
Hi 5
Done 4
Done 5
Hi 6
Hi 7
Done 6
Done 7
Hi 9
Hi 8
Done 8
Done 9
</pre>
				<br>
				List of resources or task options
				<table class="table table-striped">
					<tr>
						<th> Variable name </th>
						<th> Default value </th>
						<th> Resource / Task options </th>
					</tr>
					<tr>
						<td> <code>cpus</code> </td>	
						<td> 1 </td> 
						<td> Number of CPU (cores) used by the process. </td> 
					</tr>
					<tr>
						<td> <code>canFail</code> </td>	
						<td> false </td> 
						<td> If true, a task is allowed to fail. This means that a failed task execution does not result in program termination and checkpointing. </td> 
					</tr>
					<tr>
						<td> <code>timeout</code> </td>	
						<td> 0 </td> 
						<td> Number of seconds that a process is allowed to execute. Ignored if zero or less. If process runs more than <code>timeout</code> seconds, it is killed. </td> 
					</tr>
					<tr>
						<td> <code>node</code> </td>	
						<td>  </td> 
						<td> If possible this task should be executed on a partucilar cluster node. This option is ony used for cluster systems and ignored on any other systems. </td> 
					</tr>
					<tr>
						<td> <code>queue</code> </td>	
						<td>  </td> 
						<td> Queue name of preferred execution queue (only for cluster systems). </td> 
					</tr>
				</table>

				<h3> Conditional execution </h3>
				Conditiona execution of task can, obviously, be achieved using an <code>if</code> statement.
				Since conditional execution is so common, we allow for some syntatic sugar by <code> task( experession1, experession2, ... ) { ... } </code>.
				where <code>experession1</code>, <code>experession2</code>, etc. are bool expressions.
				The task is executed only if all <code>bool</code> expressions are <code>true</code>.
				<br>
				So the following programs are equivalent
<pre>
bool shouldExec = true
if( shouldExec ) {
	task( cpus = 4 ) {
		sys echo RUNNING
	}
}
</pre>
				Is the same as:
<pre>
bool shouldExec = true

task( shouldExec, cpus = 4 ) {
	sys echo RUNNING
}

</pre>

				<i class="icon-warning-sign"></i> This feature is particularly useful when combined with the dependency operator <code>&lt;-</code>
				</p>
        </section>

        <!-- ================================================== -->
        <section id="log">
          <div class="page-header">
            <h1>13. Logging </h1>
          </div>
				<p class="lead"> By default all command execution is logged.  <p>

				Both <code>sys</code> and <code>task</code> commands create a shell file, execute it and save STDOUT and STDERR to files.
				This gives you an automatic log of everything that was executed, as well as the detials of the outputs from each execution.
				<br>
				For example, let's create a simple program and run it
<pre>
string name = "Pablo"

sys echo Hello $name
</pre>

				Now let's run this script, we use <code>-v</code> command line option to make the output verbose:
<pre>
$ bds -v z.bds
00:00:00.169	Process ID: z.bds.20130328_224825_685
00:00:00.174	Queuing task 'z.bds.20130328_224825_685/sys.line_4.id_1'
00:00:00.674	Running task 'z.bds.20130328_224825_685/sys.line_4.id_1'
00:00:00.689	Finished task 'z.bds.20130328_224825_685/sys.line_4.id_1'
Hello Pablo
00:00:00.692	Finished running. Exit value : 0
</pre>
				What happened?
				<ol>
					<li> bds parses the <code>sys</code> statement and interpolates "echo Hello $name" to "echo Hello Pablo"

					<li> Creates a taks and assigns a task ID <code>z.bds.20130328_224825_685/sys.line_4.id_1</code>

					<li> It creates a shell script file <code>z.bds.20130328_224825_685/sys.line_4.id_1.sh</code> with the code:
<pre>
$ cat z.bds.20130328_224825_685/sys.line_4.id_1.sh 
#!/bin/sh

echo Hello Pablo
</pre>

					<li> Then executes this shell script and saves stdout and stderr to z.bds.20130328_224825_685/sys.line_4.id_1.stdout and z.bds.20130328_224825_685/sys.line_4.id_1.stderr respectively
<pre>
$ cat z.bds.20130328_224825_685/sys.line_4.id_1.stdout
Hello Pablo
$ cat z.bds.20130328_224825_685/sys.line_4.id_1.stderr
</pre>
					Notice that there was no output on stderr (it's empty)

					<li> Command finished without proglems, so it continues with the res of the program
				
				</ol>
				So at the end of the run, we have the file with the script, plus the stdout and stderr files.
				All the information is logged automatically.
				<br>

				</p>
        </section>


        <!-- ================================================== -->
        <section id="waitExpr">
          <div class="page-header">
            <h1>14. Wait </h1>
          </div>
				<p class="lead"> Task coordination mechanisms rely havily on wait statements.</p>
				As we mentioend several times, task execution order is not waranteed.
<pre>
$ cat z.bds
for( int i=0 ; i < 10 ; i++ ) task echo BEFORE $i
for( int i=0 ; i < 10 ; i++ ) task echo AFTER $i

$ bds z.bds
BEFORE 0
BEFORE 4
BEFORE 3
BEFORE 2
BEFORE 1
BEFORE 5
BEFORE 7
BEFORE 6
BEFORE 8
AFTER 1
AFTER 0
BEFORE 9	<-- !!!
AFTER 6
AFTER 5
AFTER 4
AFTER 3
AFTER 2
AFTER 7
AFTER 8
AFTER 9
</pre>
				If a task must be executed after another task finished, we can introduce a wait statement.
<pre>
$ cat z.bds
for( int i=0 ; i < 10 ; i++ ) task echo BEFORE $i
wait	# Wait until ALL scheduled tasks finish
for( int i=0 ; i < 10 ; i++ ) task echo AFTER $i

$ bds z.bds
BEFORE 0
BEFORE 1
BEFORE 2
BEFORE 4
BEFORE 3
BEFORE 5
BEFORE 6
BEFORE 7
BEFORE 9
BEFORE 8
AFTER 2
AFTER 1
AFTER 3
AFTER 5
AFTER 6
AFTER 0
AFTER 4
AFTER 7
AFTER 8
AFTER 9
</pre>
				We can also wait for a specific task to finish by providins a task ID <code>wait taskId</code>, e.g.:
<pre>
string tid = task echo Hi
wait tid	# Wait only for one task
</pre>

				Or you can wait for a list of tasks. 
				For instance, in this program, we create a list of two task IDs and <code>wait</code> on the list:
<pre>
string[] tids

for( int i=0 ; i < 10 ; i++ ) {
	# Tasks that wait a random amount of time
    int sleepTime = randInt( 5 )
    string tid = task echo BEFORE $i ; sleep $sleepTime ; echo DONE $i

	# We only want to wait for the firs two tasks
    if( i < 2 ) tids.add(tid)
}

# Wait for all tasks in the lists (only the first two tasks)
wait tids
print("End of wait\n")
</pre>

			When we run it, we get:
<pre>
$ bds z.bds
BEFORE 2
BEFORE 0
BEFORE 7
BEFORE 5
BEFORE 6
BEFORE 4
BEFORE 3
BEFORE 1
DONE 0
DONE 3
DONE 4
DONE 5
DONE 6
DONE 7
BEFORE 8
BEFORE 9
DONE 1
End of wait		<- Wait finished here
DONE 2
DONE 8
DONE 9
</pre>


				<i class="icon-warning-sign"></i> There is an implicit <code>wait</code> statement at the end of the program. 
				So a program does not exit untill all tasks have finished runnig.
				<br>

				<br>
        </section>

        <!-- ================================================== -->
        <section id="dep">
          <div class="page-header">
            <h1>14. Dependency operator </h1>
          </div>
				<p class="lead"> You can use a dependency operator <code>&lt;-</code> to decide whether tasks should be run or not, based on file existence and timestamps (like "make" command).  </p>
				<br>
				<br>
        </section>

        <!-- ================================================== -->
        <section id="check">
          <div class="page-header">
            <h1>15. Checkpoints </h1>
          </div>
				<p class="lead"> BigDataScript is intended have absolute serialization, which is achieved using checkpoint commands.</p>
				Fully serializable program states and checkpoints help to recover from failures in complex pipelines.<p>
				<br>
				<br>
        </section>

        <!-- ================================================== -->
        <section id="vars">
          <div class="page-header">
            <h1>16. Predefined variables </h1>
          </div>
				<p class="lead"> BigDataScript provides some predefined variables.</p>

				<br>
				<br>
        </section>
      </div>
    </div>

  </div>



    <!-- Footer
    ================================================== -->
      <footer>
        <p class="text-center">&copy; Pablo Cingolani 2013</p>
      </footer>


    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap-transition.js"></script>
    <script src="js/bootstrap-alert.js"></script>
    <script src="js/bootstrap-modal.js"></script>
    <script src="js/bootstrap-dropdown.js"></script>
    <script src="js/bootstrap-scrollspy.js"></script>
    <script src="js/bootstrap-tab.js"></script>
    <script src="js/bootstrap-tooltip.js"></script>
    <script src="js/bootstrap-popover.js"></script>
    <script src="js/bootstrap-button.js"></script>
    <script src="js/bootstrap-collapse.js"></script>
    <script src="js/bootstrap-carousel.js"></script>
    <script src="js/bootstrap-typeahead.js"></script>
    <script src="js/bootstrap-affix.js"></script>

    <script src="js/holder/holder.js"></script>
    <script src="js/google-code-prettify/prettify.js"></script>

    <script src="js/application.js"></script>



  </body>
</html>
