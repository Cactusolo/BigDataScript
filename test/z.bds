#!/usr/bin/env bds

void doStuff(string dir) {
	in := "$dir/in.txt"
	out := "$dir/out.txt"

	sys date > $in ; echo $in

	task( out <- in ) sys ( echo Root task ; cat $in ) > $out ; echo $out

	for( int i=0 ; i < 3 ; i++ ) {
		outi := "$dir/out_$i.txt"
		task( outi <- out ) sys ( echo task $i ; cat $out ) > $outi ; echo $outi
	}
}

#---
# Main
#---


dir := "$HOME/zzz"
task echo Hi $dir
#sys rm -rvf $dir

doStuff(dir)

# Parallel
#dirs := [ "$dir/par", "$dir/par2"]
#for( string dir : dirs ) {
	#dirs.mkdir()
	#par doStuff("$HOME/zzz/par")
#}

wait
print "Done\n"
