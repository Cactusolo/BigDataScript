#!/usr/bin/env bds

void doStuff(string dir) {
	in := "$dir/in.txt"
	out := "$dir/out.txt"

	sys date > $in ; echo $in

	task( out <- in ) sys ( echo Root task ; cat $in ) > $out ; echo $out

	for( int i=0 ; i < 3 ; i++ ) {
		outi := "$dir/out_$i.txt"
		task( outi <- out ) sys ( echo task $i ; cat $out ) > $outi ; echo $outi
	}
}

# Main
#sys rm -rvf $HOME/zzz ; mkdir -p $HOME/zzz/par; mkdir -p $HOME/zzz/par2

par doStuff("$HOME/zzz/par")
par doStuff("$HOME/zzz/par2")
doStuff("$HOME/zzz")

wait
print "Done\n"
